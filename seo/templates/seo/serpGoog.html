{% extends "base.html" %}
{% load static %}


{% block css %}
<style>
    

</style>
{% endblock css %}

{% load crispy_forms_tags %}
{% block pageContent %}
<div class="container">
    <div class="container">
        <div class="row d-flex justify-content-center">
            <div class="col-md-10">
                <form method="post">
                    {% csrf_token %}
                    <fieldset class="form-group">
                        <legend class="border-bottom mb-4 main-t">Get Search Engine Results</legend>
                        {% crispy form %}
                    </fieldset>
                    
                    
                </form>
            </div>
            <div class="col-md-10 mt-3">
                <canvas id="domainChart" class="mt-3"></canvas>

            </div>
            <div class="col-md-11 mt-2">
                {% if rankDf %}
                    {{ rankDf | safe }}
                {% endif %}
            </div>
            <div class="col-md-12 mt-3" style="height: 600px; overflow-y: scroll; max-width:870px;overflow-x: scroll;">
                {% if serpDf %}
                    {{ serpDf | safe }}
                {% endif %}
            </div>

        </div>
    </div>
</div>
{% endblock pageContent %}

{% block javascript %}
<script>



    const domainJson = {{ domains_df|safe }};
    console.log(domainJson);

    function createDomainChart(jsonData) {
        var ctx = document.getElementById('domainChart').getContext('2d');
        var labels = jsonData.map(function(obj) {
            return obj["displayLink"];
        });
        var data = jsonData.map(function(obj) {
            return obj["frequency"];
        });

        // Define the chart data
        var data = {
        labels: labels,
        datasets: [{
            label: 'Domains appearance in the search results',
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            borderWidth: 1,
            barPercentage: 0.5, // Adjust this value to control the width of the bars
            categoryPercentage: 1,
            data: data
        }]
        };

        // Create the chart
        var myChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
            indexAxis: 'y',
            scales: {
                x: {
                    beginAtZero: true
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        display: false
                    }
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'SERP domain reoccurance', 
                    padding: {
                        top: 10,
                        bottom: 10
                    }
                }
            }
        }
        });
    }
    const domain = domainJson.slice(0,20);
    createDomainChart(domain);
   
</script>



{% endblock javascript %}